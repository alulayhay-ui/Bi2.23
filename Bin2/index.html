<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Born in 2002ï¼šLevel 23 â”€ å„€å¼ç™»å…¥ç³»çµ±</title>
  <style>
    :root{
      --accent:#5ba8ff;
      --accent-soft:#7ab6ff;
      --gold:#ffc857;
      --bg-deep:#050816;
    }
    *{box-sizing:border-box;}
    html,body{
      margin:0;padding:0;
      height:100%;
      font-family:"Segoe UI",system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
      background:radial-gradient(circle at top,#1b2742 0,#050816 45%,#000 100%);
      color:#d6e2ff;
    }
    body{
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
      overflow:hidden;
      position:relative;
    }

    .bg-stars{
      position:fixed;inset:0;
      background:radial-gradient(circle,rgba(255,255,255,.24) 1px,transparent 1px);
      background-size:3px 3px;
      opacity:.22;
      animation:starMove 40s linear infinite;
      pointer-events:none;
      z-index:0;
    }
    @keyframes starMove{from{transform:translateY(0);}to{transform:translateY(-900px);}}
    .bg-tribal{
      position:fixed;inset:0;
      background:
        radial-gradient(circle at 0 0,rgba(91,228,255,.3),transparent 55%),
        radial-gradient(circle at 100% 100%,rgba(255,200,87,.35),transparent 55%);
      mix-blend-mode:screen;
      opacity:.18;
      pointer-events:none;
      z-index:0;
    }

    .app-wrap{
      position:relative;
      z-index:2;
      width:100%;
      max-width:980px;
      display:flex;
      gap:24px;
    }
    @media(max-width:900px){
      body{align-items:flex-start;}
      .app-wrap{
        flex-direction:column;
        margin-top:22px;
        max-width:100%;
      }
    }

    .preview-column{
      flex:0 0 320px;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
    }
    @media(max-width:900px){
      .preview-column{
        order:-1;
        flex:0 0 auto;
      }
    }
    .spirit-card{
      position:relative;
      width:100%;
      max-width:320px;
      aspect-ratio:3/4;
      border-radius:20px;
      background:radial-gradient(circle at top,#1b2840 0,rgba(5,8,22,.98) 45%,rgba(0,0,0,.98) 100%);
      overflow:hidden;
      border:1px solid rgba(123,182,255,.55);
      box-shadow:
        0 0 24px rgba(0,0,0,.9),
        0 0 32px rgba(91,228,255,.38);
      transition:border-color .3s,box-shadow .3s;
    }
    .spirit-card::before{
      content:"LEVEL 23";
      position:absolute;
      top:8px;left:14px;
      font-size:11px;
      letter-spacing:2px;
      opacity:.58;
      color:var(--accent-soft);
    }
    .spirit-orb{
      position:absolute;
      inset:-20%;
      background:
        radial-gradient(circle at 20% 0,rgba(123,182,255,.58),transparent 55%),
        radial-gradient(circle at 80% 100%,rgba(255,200,135,.48),transparent 60%);
      mix-blend-mode:screen;
      opacity:.75;
      filter:blur(3px);
      animation:spiritWave 9s ease-in-out infinite alternate;
    }
    @keyframes spiritWave{
      0%{transform:translate3d(-8px,0,0) scale(1);}
      50%{transform:translate3d(4px,-6px,0) scale(1.04);}
      100%{transform:translate3d(6px,4px,0) scale(1.02);}
    }
    .spirit-portrait-wrap{
      position:absolute;
      inset:18% 12% 18% 12%;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .spirit-portrait{
      width:100%;
      height:100%;
      object-fit:cover;
      filter:
        grayscale(1)
        contrast(1.2)
        brightness(1.3)
        drop-shadow(0 0 18px rgba(123,182,255,.8));
      opacity:.82;
      mix-blend-mode:screen;
      transition:filter .3s,opacity .3s;
    }
    .spirit-glow-ring{
      position:absolute;
      inset:14%;
      border-radius:26px;
      border:1px solid rgba(123,182,255,.55);
      box-shadow:
        0 0 30px rgba(123,182,255,.65),
        0 0 40px rgba(255,200,135,.3);
      opacity:.85;
      animation:spiritRing 5.5s ease-in-out infinite;
      transition:border-color .3s,box-shadow .3s;
    }
    @keyframes spiritRing{
      0%,100%{transform:scale(0.98);opacity:.7;}
      50%{transform:scale(1.02);opacity:1;}
    }
    .spirit-particles{
      position:absolute;
      inset:0;
      background-image:
        radial-gradient(circle,rgba(255,255,255,.7) 1px,transparent 1px),
        radial-gradient(circle,rgba(123,182,255,.8) 1px,transparent 1px);
      background-size:5px 5px,7px 7px;
      mix-blend-mode:screen;
      opacity:.25;
      animation:particleDrift 18s linear infinite;
    }
    @keyframes particleDrift{
      0%{transform:translate3d(0,0,0);}
      100%{transform:translate3d(-40px,-40px,0);}
    }
    .spirit-meta{
      position:absolute;
      bottom:10px;
      left:12px;
      right:12px;
      font-size:11px;
      display:flex;
      justify-content:space-between;
      gap:6px;
      opacity:.9;
    }
    .spirit-meta span{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}

    .screen-column{
      flex:1;
      position:relative;
    }
    .screen{
      display:none;
      background:rgba(10,13,30,.78);
      border-radius:18px;
      padding:20px 18px 18px;
      border:1px solid rgba(255,255,255,.15);
      box-shadow:0 0 26px rgba(0,0,0,.7);
      backdrop-filter:blur(14px);
    }
    .screen.active{display:block;}

    .screen-title{
      font-size:20px;
      margin:0 0 4px;
      color:var(--accent-soft);
      text-shadow:0 0 10px #3f8bff;
    }
    .screen-sub{
      font-size:13px;
      opacity:.92;
      margin-bottom:10px;
    }

    label{
      display:block;
      font-size:13px;
      margin:6px 0 3px;
      opacity:.88;
    }
    input[type="text"],
    input[type="number"],
    textarea,
    select{
      width:100%;
      padding:9px 10px;
      border-radius:9px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.32);
      color:#fff;
      font-size:13px;
      outline:none;
    }
    textarea{min-height:70px;resize:vertical;}
    input[readonly]{
      opacity:.7;
      background:rgba(255,255,255,.04);
    }

    .row-2{
      display:flex;
      gap:8px;
    }
    @media(max-width:600px){
      .row-2{flex-direction:column;}
    }

    button{
      border:none;
      border-radius:999px;
      padding:10px 16px;
      font-size:14px;
      cursor:pointer;
      font-weight:600;
    }
    .btn-primary{
      background:linear-gradient(135deg,#6ab5ff,#ffc857);
      color:#050816;
      box-shadow:0 0 16px rgba(111,189,255,.7);
      width:100%;
      margin-top:10px;
    }
    .btn-secondary{
      background:rgba(255,255,255,.06);
      color:#e2ebff;
      border:1px solid rgba(255,255,255,.25);
    }

    .small-hint{
      font-size:11px;
      opacity:.78;
      margin-top:6px;
    }

    .loading-bar{
      margin-top:10px;
      height:10px;
      border-radius:999px;
      background:rgba(255,255,255,.09);
      overflow:hidden;
      display:none;
    }
    .loading-fill{
      height:100%;
      width:0%;
      background:linear-gradient(90deg,#5be4ff,#ffc857);
      transition:width .35s;
    }
    .error-msg{
      color:#ff6b7a;
      font-size:12px;
      margin-top:6px;
      display:none;
    }

    .stats-row{
      display:flex;
      gap:8px;
      margin-top:4px;
    }
    .stat-box{
      flex:1;
    }
    .stat-box label{
      font-size:11px;
      margin-bottom:2px;
    }
    .stat-box input{
      text-align:center;
    }

    .completion-overlay{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background:radial-gradient(circle at top,rgba(8,12,30,.92),rgba(2,3,10,.96));
      z-index:20;
    }
    .completion-panel{
      position:relative;
      width:100%;
      max-width:420px;
      border-radius:20px;
      padding:18px 16px 14px;
      border:1px solid rgba(255,200,135,.9);
      box-shadow:0 0 26px rgba(255,200,135,.7),0 0 32px rgba(91,228,255,.7);
      background:linear-gradient(145deg,rgba(5,8,22,.96),rgba(10,18,40,.98));
      transition:border-color .3s,box-shadow .3s;
    }
    .completion-avatar-wrap{
      width:90px;height:90px;
      border-radius:50%;
      margin:0 auto 10px;
      position:relative;
      overflow:hidden;
      border:2px solid rgba(255,200,135,.95);
      box-shadow:0 0 18px rgba(255,200,135,.9);
    }
    .completion-avatar-wrap img{
      width:100%;height:100%;object-fit:cover;
    }
    .completion-avatar-glow{
      position:absolute;inset:-20%;
      background:radial-gradient(circle,rgba(255,200,135,.85),transparent 60%);
      mix-blend-mode:screen;
      opacity:.7;
      pointer-events:none;
      animation:completionGlow 3s ease-in-out infinite;
    }
    @keyframes completionGlow{
      0%,100%{opacity:.45;transform:scale(1);}
      50%{opacity:1;transform:scale(1.08);}
    }
    .completion-title{
      text-align:center;
      font-size:18px;
      margin-bottom:2px;
      color:#ffe9b0;
    }
    .completion-sub{
      text-align:center;
      font-size:12px;
      opacity:.9;
      margin-bottom:8px;
    }
    .completion-mini-card{
      margin-top:6px;
      padding:8px 10px 6px;
      border-radius:12px;
      border:1px solid rgba(255,200,135,.9);
      background:linear-gradient(135deg,rgba(10,14,32,.98),rgba(4,6,20,.98));
      box-shadow:0 0 14px rgba(255,200,135,.65);
      font-size:12px;
      transition:border-color .3s,box-shadow .3s;
    }
    .cmc-title{
      font-size:11px;
      letter-spacing:1px;
      opacity:.82;
      margin-bottom:4px;
      color:#ffe9b0;
    }
    .cmc-line{
      display:flex;
      justify-content:space-between;
      gap:6px;
      margin:1px 0;
    }
    .cmc-label{opacity:.78;}
    .cmc-value{text-align:right;font-weight:500;}
    .completion-line{
      display:flex;
      justify-content:space-between;
      gap:8px;
      font-size:12px;
      margin-top:4px;
    }
    .completion-line span:last-child{text-align:right;}
    .completion-reminder{
      margin-top:8px;
      padding:8px 8px 6px;
      border-radius:10px;
      border:1px solid rgba(123,182,255,.6);
      background:rgba(4,8,20,.92);
      font-size:11px;
    }
    .completion-actions{
      margin-top:10px;
      text-align:center;
    }
    .completion-btn{
      padding:7px 16px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.28);
      font-size:13px;
      cursor:pointer;
    }
    .completion-btn-primary{
      background:linear-gradient(135deg,#6ab5ff,#ffc857);
      color:#050816;
      border:none;
    }

    #toast{
      position:fixed;
      bottom:18px;left:50%;
      transform:translateX(-50%);
      background:rgba(14,20,40,.96);
      border-radius:999px;
      padding:8px 16px;
      font-size:12px;
      border:1px solid rgba(123,182,255,.7);
      opacity:0;
      pointer-events:none;
      transition:opacity .25s,transform .25s;
      z-index:30;
    }
    #toast.show{
      opacity:1;
      transform:translateX(-50%) translateY(-4px);
    }

    .entry-card{
      padding:20px 18px 16px;
      border-radius:20px;
      background:linear-gradient(140deg,rgba(10,13,30,.96),rgba(4,5,18,.98));
      border:1px solid rgba(255,200,87,.9);
      box-shadow:0 0 26px rgba(0,0,0,.85),0 0 28px rgba(255,200,87,.55);
      transition:border-color .3s,box-shadow .3s;
    }
    .entry-card-title{
      font-size:20px;
      color:#fff7dd;
      text-align:center;
      margin:0 0 2px;
      text-shadow:0 0 10px rgba(255,200,87,.7),0 0 16px rgba(91,228,255,.7);
    }
    .entry-card-sub{
      font-size:12px;
      text-align:center;
      opacity:.9;
      margin-bottom:10px;
    }
    .entry-card-tagline{
      font-size:11px;
      text-align:center;
      opacity:.85;
      margin-bottom:10px;
    }
    .divider{
      height:1px;
      margin:8px 0 10px;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,.4),transparent);
    }
    .entry-row{
      display:flex;
      justify-content:space-between;
      gap:6px;
      margin:2px 0;
      font-size:13px;
    }
    .entry-label{opacity:.78;}
    .entry-value{text-align:right;font-weight:600;}
    .role-badge,.element-badge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:2px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.35);
      font-size:11px;
      margin-top:2px;
    }
    .element-badge{
      border-color:rgba(91,228,255,.7);
    }
    .entry-reminders{
      margin-top:12px;
      padding:10px 10px 6px;
      border-radius:12px;
      background:rgba(5,10,26,.9);
      border:1px solid rgba(123,182,255,.5);
      font-size:12px;
    }
    .entry-reminders-title{
      font-size:12px;
      font-weight:600;
      margin-bottom:4px;
      color:#5be4ff;
    }
    .entry-reminders ul{
      padding-left:18px;
      margin:4px 0;
    }
    .entry-reminders li{margin-bottom:2px;}
    .entry-hint{
      margin-top:8px;
      font-size:11px;
      text-align:center;
      opacity:.8;
    }
    .actions{
      margin-top:10px;
      display:flex;
      justify-content:center;
      gap:10px;
      font-size:12px;
      flex-wrap:wrap;
    }
    .link-btn{
      padding:6px 12px;
      border-radius:999px;
      border:1px solid rgba(123,182,255,.7);
      background:rgba(4,8,20,.9);
      color:#e7f1ff;
      text-decoration:none;
      cursor:pointer;
      font-size:12px;
    }
    .link-btn-ig{
      border-color:rgba(255,111,181,.8);
    }
  </style>
</head>
<body>
  <div class="bg-stars"></div>
  <div class="bg-tribal"></div>

  <div class="app-wrap">
    <div class="preview-column">
      <div class="spirit-card" id="spiritCard">
        <div class="spirit-orb"></div>
        <div class="spirit-portrait-wrap">
          <img id="spiritPortrait" class="spirit-portrait" src="assets/characters/default.png" alt="spirit portrait" />
        </div>
        <div class="spirit-glow-ring" id="spiritGlowRing"></div>
        <div class="spirit-particles"></div>
        <div class="spirit-meta">
          <span id="spiritName">æœªå‘½åè§’è‰²</span>
          <span id="spiritElement">ç„¡å…ƒç´ </span>
        </div>
      </div>
    </div>

    <div class="screen-column">
      <!-- Intro ç•«é¢ -->
      <section id="screen-intro" class="screen active">
        <h1 class="screen-title">Born in 2002ï¼šLevel 23</h1>
        <div class="screen-sub">
          æ­¡è¿ä¾†åˆ° Alulayhayï¼Sawawan é„­å½¥è»çš„ 23 æ­²ç”Ÿæ—¥å„€å¼ç™»å…¥ç³»çµ±ã€‚<br/>
          å„€å¼é›†åˆæ™‚é–“åœ°é»ï¼š<b>12/20 (å…­) æ™šä¸Š 10ï¼š30ã€€ä¸­å£¢å¥½æ¨‚è¿ª KTV</b>
        </div>
        <button id="btnStartRitual" class="btn-primary">é–‹å§‹ç™»å…¥å„€å¼</button>
        <div class="small-hint">é»æ“Šå¾Œé€²å…¥ç™»å…¥ç•«é¢ï¼Œå®Œæˆç¥–éˆèªè­‰èˆ‡è§’è‰²å‰µå»ºã€‚</div>
      </section>

      <!-- Login ç•«é¢ -->
      <section id="screen-login" class="screen">
        <h1 class="screen-title">LEVEL 23 ENTRY SYSTEM</h1>
        <div class="screen-sub">ç¥–éˆå·²é–‹å•Ÿå„€å¼ä¹‹é–€ï¼Œè«‹å®Œæˆç™»å…¥ã€‚</div>

        <label>è«‹ä¸Šå‚³ç©å®¶è§’è‰²ç«‹ç¹ªï¼ˆä½ çš„ç…§ç‰‡ï¼Œæœƒé¡¯ç¤ºç‚ºéˆé«”é¢¨è§’è‰²ï¼‰</label>
        <input type="file" id="avatarInput" accept="image/*" />

        <label for="loginName">ç©å®¶å§“å</label>
        <input id="loginName" type="text" placeholder="ä½ çš„åå­—" />

        <label for="loginPhone">è¯çµ¡é›»è©±</label>
        <input id="loginPhone" type="text" placeholder="è¯çµ¡æ–¹å¼ï¼ˆæ‰‹æ©Ÿ / LINEï¼‰" />

        <button id="btnLogin" class="btn-primary">æäº¤ç™»å…¥è³‡è¨Š</button>

        <div id="loginLoading" class="loading-bar">
          <div class="loading-fill" id="loginLoadingFill"></div>
        </div>
        <div id="loginError" class="error-msg">é›»è©±æ ¼å¼éŒ¯èª¤ï¼Œè«‹ç¢ºèªå¾Œå†è©¦ã€‚</div>

        <div class="small-hint">
          ç™»å…¥æˆåŠŸå¾Œå°‡é€²å…¥è§’è‰²å‰µå»ºç•«é¢ï¼Œä¸¦è‡ªå‹•å¸¶å…¥ä½ çš„å§“åèˆ‡è¯çµ¡æ–¹å¼ã€‚
        </div>
      </section>

      <!-- è§’è‰²å‰µå»ºç•«é¢ -->
      <section id="screen-create" class="screen">
        <h1 class="screen-title">å‰µå»ºè§’è‰² â”€ Level 23 å„€å¼</h1>
        <div class="screen-sub">è«‹ç‚ºé€™æ¬¡çš„ä½ è¨­å®šä¸€å€‹å°ˆå±¬è§’è‰²ï¼Œè³‡æ–™ä¹Ÿæœƒé€åˆ°è¡¨å–®ä»¥æ–¹ä¾¿è¯çµ¡èˆ‡è¨˜éŒ„ã€‚</div>

        <form id="createForm">
          <div class="row-2">
            <div style="flex:1;">
              <label>ç©å®¶å§“å</label>
              <input id="playerName" type="text" readonly />
            </div>
            <div style="flex:1;">
              <label>è¯çµ¡é›»è©±</label>
              <input id="playerPhone" type="text" readonly />
            </div>
          </div>

          <label>è§’è‰²åç¨±</label>
          <input id="charName" type="text" placeholder="ä¾‹ï¼šéˆç«é‡€è€…ã€æ˜Ÿå…‰æ—…äºº..." />

          <label>éƒ¨è½ / ä¾†è‡ªå“ªè£¡</label>
          <input id="tribe" type="text" placeholder="ä¾‹ï¼šå‘å—æ—ï¼åˆé¹¿ / å°ä¸­ / ä¸­å£¢..." />

          <label>è·æ¥­ / èº«åˆ†</label>
          <select id="role">
            <option value="">è«‹é¸æ“‡</option>
            <option value="é‡€é…’å¸« Brewer">é‡€é…’å¸« Brewer</option>
            <option value="èˆè€… Dancer">èˆè€… Dancer</option>
            <option value="å®ˆè­·è€… Guardian">å®ˆè­·è€… Guardian</option>
            <option value="çµäºº Hunter">çµäºº Hunter</option>
            <option value="æ²»ç™‚è€… Healer">æ²»ç™‚è€… Healer</option>
            <option value="ç­–å£« Strategist">ç­–å£« Strategist</option>
            <option value="æ—…äºº Traveler">æ—…äºº Traveler</option>
            <option value="è‡ªç”±å®¢ Free Spirit">è‡ªç”±å®¢ Free Spirit</option>
            <option value="å…¶ä»– Custom">å…¶ä»– Custom</option>
          </select>

          <label>å…ƒç´ å±¬æ€§</label>
          <select id="element">
            <option value="">è«‹é¸æ“‡</option>
            <option value="åœŸãƒ»åœŸåœ° Earth">åœŸãƒ»åœŸåœ° Earth</option>
            <option value="ç«ãƒ»é‡€é…’ Fire">ç«ãƒ»é‡€é…’ Fire</option>
            <option value="é¢¨ãƒ»èˆè¹ˆ Wind">é¢¨ãƒ»èˆè¹ˆ Wind</option>
            <option value="æ°´ãƒ»æƒ…æ„Ÿ Water">æ°´ãƒ»æƒ…æ„Ÿ Water</option>
            <option value="æ˜Ÿãƒ»å¤¢æƒ³ Star">æ˜Ÿãƒ»å¤¢æƒ³ Star</option>
            <option value="å½±ãƒ»æ²‰æ€ Shadow">å½±ãƒ»æ²‰æ€ Shadow</option>
          </select>

          <div class="stats-row">
            <div class="stat-box">
              <label>åŠ›é‡ STR</label>
              <input id="statStr" type="number" min="1" max="10" value="5" />
            </div>
            <div class="stat-box">
              <label>æ™ºæ…§ INT</label>
              <input id="statInt" type="number" min="1" max="10" value="5" />
            </div>
            <div class="stat-box">
              <label>é­…åŠ› CHA</label>
              <input id="statCha" type="number" min="1" max="10" value="5" />
            </div>
            <div class="stat-box">
              <label>å¹¸é‹ LUCK</label>
              <input id="statLuck" type="number" min="1" max="10" value="5" />
            </div>
          </div>

          <label>æƒ³èªªçš„è©± / çµ¦å£½æ˜Ÿçš„è¨Šæ¯</label>
          <textarea id="message" placeholder="å¯«ä¸‹ä¸€å¥æƒ³åœ¨ç•¶å¤©æˆ–ä¹‹å¾Œå°å£½æ˜Ÿèªªçš„è©±å§ï½"></textarea>

          <button type="submit" class="btn-primary">å„²å­˜è§’è‰²è³‡è¨Š</button>
        </form>

        <div class="small-hint">
          ç³»çµ±æœƒå°‡è§’è‰²è³‡è¨Šé€åˆ° Google è¡¨å–®ï¼Œä¹Ÿæœƒå­˜åœ¨æœ¬æ©Ÿæ–¹ä¾¿ä¹‹å¾Œç”Ÿæˆåœ–é‘‘èˆ‡å…¥å ´æ ¸å°ã€‚
        </div>
      </section>

      <!-- è§’è‰²å¡é  -->
      <section id="screen-entry-card" class="screen">
        <div class="entry-card" id="entryCard">
          <h1 class="entry-card-title">Born in 2002ï¼šLevel 23</h1>
          <div class="entry-card-sub">å…¥å ´è§’è‰²å¡ ENTRY PASS</div>
          <div class="entry-card-tagline">
            è«‹å°‡æ­¤ç•«é¢æˆªåœ–å„²å­˜åˆ°ç›¸ç°¿ï¼Œå…¥å ´å ±åˆ°æ™‚å‡ºç¤ºçµ¦å·¥ä½œäººå“¡ã€‚
          </div>

          <div class="divider"></div>

          <div class="entry-row">
            <div class="entry-label">è§’è‰²åç¨±ï¼š</div>
            <div class="entry-value" id="cardCharName">â”€</div>
          </div>
          <div class="entry-row">
            <div class="entry-label">ç©å®¶å§“åï¼š</div>
            <div class="entry-value" id="cardPlayerName">â”€</div>
          </div>
          <div class="entry-row">
            <div class="entry-label">ä¾†è‡ªå“ªè£¡ï¼š</div>
            <div class="entry-value" id="cardTribe">â”€</div>
          </div>

          <div class="entry-row">
            <div class="entry-label">è·æ¥­ / èº«åˆ†ï¼š</div>
            <div class="entry-value"><span class="role-badge" id="cardRole">â”€</span></div>
          </div>
          <div class="entry-row">
            <div class="entry-label">å…ƒç´ å±¬æ€§ï¼š</div>
            <div class="entry-value"><span class="element-badge" id="cardElement">â”€</span></div>
          </div>

          <div class="divider"></div>

          <div class="entry-reminders">
            <div class="entry-reminders-title">é›†åˆæ™‚é–“åœ°é» / REMINDER</div>
            <ul>
              <li>é›†åˆæ™‚é–“åœ°é»ï¼š12/20 (å…­)æ™šä¸Š 10ï¼š30ã€€ä¸­å£¢å¥½æ¨‚è¿ª KTV</li>
              <li>ç†æ€§é£²é…’ï¼Œå–é…’ä¸é–‹è»Šï¼Œé–‹è»Šä¸å–é…’ï¼</li>
              <li>å–é…’å”±æ­Œè¦å¸¶éŒ¢ï¼</li>
            </ul>
          </div>

          <div class="entry-hint">
            å»ºè­°æ“ä½œï¼šåœ¨æ‰‹æ©Ÿä¸Šé•·æŒ‰æˆªåœ–æˆ–ä½¿ç”¨è¢å¹•æˆªåœ–åŠŸèƒ½ï¼Œå°‡æ­¤è§’è‰²å¡å­˜åˆ°ç›¸ç°¿æ–¹ä¾¿å…¥å ´æ ¸å°ã€‚
          </div>

          <div class="actions">
            <button id="btnResetCharacter" class="link-btn">é‡å‰µè§’è‰²</button>
            <button id="btnBackToCreate" class="link-btn">â† å›åˆ°è§’è‰²å‰µå»º</button>
            <a href="https://www.instagram.com/allhsww/?hl=zh-tw" target="_blank" class="link-btn link-btn-ig">
              IGï½œæœ‰å•é¡Œç§è¨Š
            </a>
          </div>
        </div>
      </section>
    </div>
  </div>

  <div id="toast"></div>

  <div class="completion-overlay" id="completionOverlay">
    <div class="completion-panel">
      <div class="completion-avatar-wrap">
        <div class="completion-avatar-glow"></div>
        <img id="completionAvatar" src="assets/characters/default.png" alt="avatar" />
      </div>

      <div class="completion-title">å‰µè§’å®Œæˆ</div>
      <div class="completion-sub">ä½ çš„è§’è‰²å·²æˆåŠŸç™»å…¥ Level 23 å„€å¼ã€‚</div>

      <div class="completion-mini-card" id="completionMiniCard">
        <div class="cmc-title">å…¥å ´è§’è‰²å¡é è¦½</div>
        <div class="cmc-line">
          <span class="cmc-label">è§’è‰²ï¼š</span><span class="cmc-value" id="cmcCharName">â”€</span>
        </div>
        <div class="cmc-line">
          <span class="cmc-label">è·æ¥­ï¼š</span><span class="cmc-value" id="cmcRole">â”€</span>
        </div>
        <div class="cmc-line">
          <span class="cmc-label">å…ƒç´ ï¼š</span><span class="cmc-value" id="cmcElement">â”€</span>
        </div>
        <div class="cmc-line">
          <span class="cmc-label">ä¾†è‡ªï¼š</span><span class="cmc-value" id="cmcTribe">â”€</span>
        </div>
      </div>

      <div class="completion-line">
        <span>STR / INT / CHA / LUCKï¼š</span>
        <span>
          <span id="cStr">-</span> /
          <span id="cInt">-</span> /
          <span id="cCha">-</span> /
          <span id="cLuck">-</span>
        </span>
      </div>

      <div class="completion-reminder">
        é›†åˆæ™‚é–“åœ°é»ï¼š12/20 (å…­)æ™šä¸Š 10ï¼š30ã€€ä¸­å£¢å¥½æ¨‚è¿ª KTVã€‚<br/>
        ç†æ€§é£²é…’ï¼Œå–é…’ä¸é–‹è»Šï¼Œé–‹è»Šä¸å–é…’ï¼å–é…’å”±æ­Œè¦å¸¶éŒ¢ï¼
      </div>

      <div class="completion-actions">
        <button class="completion-btn completion-btn-primary" id="goEntryCardBtn">
          æŸ¥çœ‹è§’è‰²å¡
        </button>
      </div>
    </div>
  </div>

  <audio id="bgm" src="assets/music/bg.mp3" loop playsinline></audio>

  <script>
    function showScreen(id){
      document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
      const el=document.getElementById(id);
      if(el) el.classList.add("active");
    }
    function showToast(msg){
      const t=document.getElementById("toast");
      t.textContent=msg;
      t.classList.add("show");
      setTimeout(()=>t.classList.remove("show"),2000);
    }

    const appState={ avatarDataUrl:null, playerName:"", playerPhone:"" };

    const spiritPortrait=document.getElementById("spiritPortrait");
    const spiritName=document.getElementById("spiritName");
    const spiritElement=document.getElementById("spiritElement");
    const spiritCard=document.getElementById("spiritCard");
    const spiritGlowRing=document.getElementById("spiritGlowRing");

    function applyElementRoleStyle(elementText, roleText){
      let border="#ffc857";
      let glow="rgba(255,200,135,.7)";
      if(elementText.includes("ç«")){border="#ff6b6b";glow="rgba(255,107,107,.75)";}
      else if(elementText.includes("æ°´")){border="#4aaeff";glow="rgba(74,174,255,.75)";}
      else if(elementText.includes("é¢¨")){border="#7fd5ff";glow="rgba(127,213,255,.75)";}
      else if(elementText.includes("åœŸ")){border="#c8a15b";glow="rgba(200,161,91,.75)";}
      else if(elementText.includes("æ˜Ÿ")){border="#ffe27a";glow="rgba(255,226,122,.8)";}
      else if(elementText.includes("å½±")){border="#a18bff";glow="rgba(161,139,255,.75)";}

      if(roleText.includes("é‡€é…’å¸«")) border="#ffc857";
      else if(roleText.includes("èˆè€…")) border="#ff80c8";
      else if(roleText.includes("å®ˆè­·è€…")) border="#5be4ff";
      else if(roleText.includes("çµäºº")) border="#78e38f";
      else if(roleText.includes("æ²»ç™‚è€…")) border="#b6ffce";
      else if(roleText.includes("ç­–å£«")) border="#c9a4ff";
      else if(roleText.includes("æ—…äºº")) border="#ffb480";
      else if(roleText.includes("è‡ªç”±å®¢")) border="#7af2ff";

      if(spiritCard){
        spiritCard.style.borderColor=border;
        spiritCard.style.boxShadow=`0 0 24px rgba(0,0,0,.9),0 0 32px ${glow}`;
      }
      if(spiritGlowRing){
        spiritGlowRing.style.borderColor=border;
        spiritGlowRing.style.boxShadow=`0 0 30px ${glow},0 0 40px ${glow}`;
      }
    }

    function updateSpiritPreviewFromForm(){
      const cn=document.getElementById("charName").value.trim();
      const el=document.getElementById("element").value.trim();
      const role=document.getElementById("role").value.trim();
      spiritName.textContent=cn||"æœªå‘½åè§’è‰²";
      spiritElement.textContent=el||"ç„¡å…ƒç´ ";
      applyElementRoleStyle(el, role);
    }

    document.getElementById("btnStartRitual").addEventListener("click",()=>{
      showScreen("screen-login");
    });

    const avatarInput=document.getElementById("avatarInput");
    if(avatarInput&&spiritPortrait){
      avatarInput.addEventListener("change",e=>{
        const f=e.target.files&&e.target.files[0];
        if(!f) return;
        const reader=new FileReader();
        reader.onload=ev=>{
          const dataUrl=ev.target.result;
          appState.avatarDataUrl=dataUrl;
          spiritPortrait.src=dataUrl;
          spiritPortrait.style.opacity="0.9";
          try{sessionStorage.setItem("playerAvatar",dataUrl);}catch(err){}
        };
        reader.readAsDataURL(f);
      });
    }

    const storedAvatar=sessionStorage.getItem("playerAvatar");
    if(storedAvatar){
      appState.avatarDataUrl=storedAvatar;
      spiritPortrait.src=storedAvatar;
      spiritPortrait.style.opacity="0.9";
    }

    const loginName=document.getElementById("loginName");
    const loginPhone=document.getElementById("loginPhone");
    const btnLogin=document.getElementById("btnLogin");
    const loginLoading=document.getElementById("loginLoading");
    const loginLoadingFill=document.getElementById("loginLoadingFill");
    const loginError=document.getElementById("loginError");

    btnLogin.addEventListener("click",()=>{
      loginError.style.display="none";
      const name=loginName.value.trim();
      const phone=loginPhone.value.trim();
      const digits=phone.replace(/\D/g,"");

      if(!name||digits.length<8){
        loginError.style.display="block";
        return;
      }

      loginLoading.style.display="block";
      loginLoadingFill.style.width="35%";
      setTimeout(()=>{loginLoadingFill.style.width="87%";},300);

      setTimeout(()=>{
        loginLoadingFill.style.width="100%";
        setTimeout(()=>{
          loginLoading.style.display="none";
          appState.playerName=name;
          appState.playerPhone=phone;
          sessionStorage.setItem("playerName",name);
          sessionStorage.setItem("playerPhone",phone);

          alert("ç¥–éˆå·²æ¥å—ä½ çš„ç™»å…¥ã€‚è«‹å‰å¾€å‰µå»ºè§’è‰²ã€‚");
          document.getElementById("playerName").value=name;
          document.getElementById("playerPhone").value=phone;
          showScreen("screen-create");
        },500);
      },900);
    });

    const prevName=sessionStorage.getItem("playerName");
    const prevPhone=sessionStorage.getItem("playerPhone");
    if(prevName) loginName.value=prevName;
    if(prevPhone) loginPhone.value=prevPhone;

    const form=document.getElementById("createForm");
    const fields={
      playerName:document.getElementById("playerName"),
      playerPhone:document.getElementById("playerPhone"),
      charName:document.getElementById("charName"),
      tribe:document.getElementById("tribe"),
      role:document.getElementById("role"),
      element:document.getElementById("element"),
      str:document.getElementById("statStr"),
      int:document.getElementById("statInt"),
      cha:document.getElementById("statCha"),
      luck:document.getElementById("statLuck"),
      message:document.getElementById("message")
    };

    document.getElementById("charName").addEventListener("input",updateSpiritPreviewFromForm);
    document.getElementById("element").addEventListener("change",updateSpiritPreviewFromForm);
    document.getElementById("role").addEventListener("change",updateSpiritPreviewFromForm);

    const GOOGLE_FORM_URL="https://docs.google.com/forms/u/0/d/e/1FAIpQLSfV50KRQIQW5MzlvodEHaNSRWxAbr9UNhioqpqRuA9ZftYbCg/formResponse";
    const GOOGLE_FIELDS={
      playerName:"entry.1692967079",
      playerPhone:"entry.1724405603",
      charName:"entry.1815456712",
      tribe:"entry.70379778",
      role:"entry.71969897",
      element:"entry.227903663",
      str:"entry.1290922171",
      int:"entry.557939827",
      cha:"entry.1703247253",
      luck:"entry.1483548557",
      message:"entry.232807868"
    };

    async function submitToGoogle(data){
      const fd=new FormData();
      fd.append(GOOGLE_FIELDS.playerName,data.playerName||"");
      fd.append(GOOGLE_FIELDS.playerPhone,data.playerPhone||"");
      fd.append(GOOGLE_FIELDS.charName,data.charName||"");
      fd.append(GOOGLE_FIELDS.tribe,data.tribe||"");
      fd.append(GOOGLE_FIELDS.role,data.role||"");
      fd.append(GOOGLE_FIELDS.element,data.element||"");
      fd.append(GOOGLE_FIELDS.str,data.stats.str||"");
      fd.append(GOOGLE_FIELDS.int,data.stats.int||"");
      fd.append(GOOGLE_FIELDS.cha,data.stats.cha||"");
      fd.append(GOOGLE_FIELDS.luck,data.stats.luck||"");
      fd.append(GOOGLE_FIELDS.message,data.message||"");

      try{
        await fetch(GOOGLE_FORM_URL,{method:"POST",body:fd,mode:"no-cors"});
      }catch(e){
        console.warn("é€å‡º Google è¡¨å–®å¤±æ•—ï¼ˆå‰ç«¯å…è¨±å¿½ç•¥ï¼‰",e);
      }
    }

    form.addEventListener("submit",async e=>{
      e.preventDefault();
      const data={
        playerName:fields.playerName.value.trim(),
        playerPhone:fields.playerPhone.value.trim(),
        charName:fields.charName.value.trim(),
        tribe:fields.tribe.value.trim(),
        role:fields.role.value.trim(),
        element:fields.element.value.trim(),
        stats:{
          str:fields.str.value||"",
          int:fields.int.value||"",
          cha:fields.cha.value||"",
          luck:fields.luck.value||""
        },
        message:fields.message.value.trim()
      };

      const list=JSON.parse(localStorage.getItem("level23Characters")||"[]");
      list.push(data);
      localStorage.setItem("level23Characters",JSON.stringify(list));
      localStorage.setItem("level23LastCharacter",JSON.stringify(data));

      await submitToGoogle(data);
      showToast("è§’è‰²è³‡è¨Šå·²å„²å­˜ âœ”");
      showCompletion(data);
    });

    function showCompletion(data){
      const overlay=document.getElementById("completionOverlay");
      if(!overlay) return;

      document.getElementById("cStr").textContent=data.stats.str||"-";
      document.getElementById("cInt").textContent=data.stats.int||"-";
      document.getElementById("cCha").textContent=data.stats.cha||"-";
      document.getElementById("cLuck").textContent=data.stats.luck||"-";

      document.getElementById("cmcCharName").textContent=data.charName||"æœªå‘½åè§’è‰²";
      document.getElementById("cmcRole").textContent=data.role||"æœªè¨­å®šè·æ¥­";
      document.getElementById("cmcElement").textContent=data.element||"â”€";
      document.getElementById("cmcTribe").textContent=data.tribe||"â”€";

      const avatarImg=document.getElementById("completionAvatar");
      const storedAvatar=appState.avatarDataUrl||sessionStorage.getItem("playerAvatar");
      if(avatarImg&&storedAvatar) avatarImg.src=storedAvatar;

      const role=data.role||"";
      const element=data.element||"";
      let border="#ffc857";
      let glow="rgba(255,200,135,.7)";

      if(element.includes("ç«")){border="#ff6b6b";glow="rgba(255,107,107,.75)";}
      else if(element.includes("æ°´")){border="#4aaeff";glow="rgba(74,174,255,.75)";}
      else if(element.includes("é¢¨")){border="#7fd5ff";glow="rgba(127,213,255,.75)";}
      else if(element.includes("åœŸ")){border="#c8a15b";glow="rgba(200,161,91,.75)";}
      else if(element.includes("æ˜Ÿ")){border="#ffe27a";glow="rgba(255,226,122,.8)";}
      else if(element.includes("å½±")){border="#a18bff";glow="rgba(161,139,255,.75)";}

      if(role.includes("é‡€é…’å¸«")) border="#ffc857";
      else if(role.includes("èˆè€…")) border="#ff80c8";
      else if(role.includes("å®ˆè­·è€…")) border="#5be4ff";
      else if(role.includes("çµäºº")) border="#78e38f";
      else if(role.includes("æ²»ç™‚è€…")) border="#b6ffce";
      else if(role.includes("ç­–å£«")) border="#c9a4ff";
      else if(role.includes("æ—…äºº")) border="#ffb480";
      else if(role.includes("è‡ªç”±å®¢")) border="#7af2ff";

      const panel=document.querySelector(".completion-panel");
      const miniCard=document.getElementById("completionMiniCard");
      if(panel){
        panel.style.borderColor=border;
        panel.style.boxShadow=`0 0 26px ${glow},0 0 34px ${glow}`;
      }
      if(miniCard){
        miniCard.style.borderColor=border;
        miniCard.style.boxShadow=`0 0 18px ${glow}`;
      }

      applyElementRoleStyle(element, role);
      overlay.style.display="flex";
    }

    document.getElementById("goEntryCardBtn").addEventListener("click",()=>{
      document.getElementById("completionOverlay").style.display="none";
      const last=localStorage.getItem("level23LastCharacter");
      let data=null;
      if(last){
        try{data=JSON.parse(last);}catch(e){}
      }
      if(data) applyEntryCard(data);
      showScreen("screen-entry-card");
    });

    function applyEntryCard(data){
      document.getElementById("cardCharName").textContent=data.charName||"æœªå‘½åè§’è‰²";
      document.getElementById("cardPlayerName").textContent=data.playerName||"Player";
      document.getElementById("cardTribe").textContent=data.tribe||"â”€";
      document.getElementById("cardRole").textContent=data.role||"â”€";
      document.getElementById("cardElement").textContent=data.element||"â”€";

      const role=data.role||"";
      const element=data.element||"";
      let border="#ffc857";
      let glow="rgba(255,200,135,.7)";
      if(element.includes("ç«")){border="#ff6b6b";glow="rgba(255,107,107,.75)";}
      else if(element.includes("æ°´")){border="#4aaeff";glow="rgba(74,174,255,.75)";}
      else if(element.includes("é¢¨")){border="#7fd5ff";glow="rgba(127,213,255,.75)";}
      else if(element.includes("åœŸ")){border="#c8a15b";glow="rgba(200,161,91,.75)";}
      else if(element.includes("æ˜Ÿ")){border="#ffe27a";glow="rgba(255,226,122,.8)";}
      else if(element.includes("å½±")){border="#a18bff";glow="rgba(161,139,255,.75)";}

      if(role.includes("é‡€é…’å¸«")) border="#ffc857";
      else if(role.includes("èˆè€…")) border="#ff80c8";
      else if(role.includes("å®ˆè­·è€…")) border="#5be4ff";
      else if(role.includes("çµäºº")) border="#78e38f";
      else if(role.includes("æ²»ç™‚è€…")) border="#b6ffce";
      else if(role.includes("ç­–å£«")) border="#c9a4ff";
      else if(role.includes("æ—…äºº")) border="#ffb480";
      else if(role.includes("è‡ªç”±å®¢")) border="#7af2ff";

      const card=document.getElementById("entryCard");
      if(card){
        card.style.borderColor=border;
        card.style.boxShadow=`0 0 26px ${glow},0 0 34px ${glow}`;
      }
    }

    const resetBtn=document.getElementById("btnResetCharacter");
    if(resetBtn){
      resetBtn.addEventListener("click",()=>{
        const listRaw=localStorage.getItem("level23Characters");
        if(listRaw){
          try{
            const list=JSON.parse(listRaw);
            if(Array.isArray(list)&&list.length>0){
              list.pop();
              localStorage.setItem("level23Characters",JSON.stringify(list));
            }
          }catch(e){
            console.warn("é‡å‰µè§’è‰²æ™‚è§£æè§’è‰²åˆ—è¡¨å¤±æ•—",e);
          }
        }

        localStorage.removeItem("level23LastCharacter");

        fields.charName.value="";
        fields.tribe.value="";
        fields.role.value="";
        fields.element.value="";
        fields.str.value="5";
        fields.int.value="5";
        fields.cha.value="5";
        fields.luck.value="5";
        fields.message.value="";

        appState.avatarDataUrl=null;
        try{
          sessionStorage.removeItem("playerAvatar");
        }catch(e){
          console.warn("æ¸…é™¤ playerAvatar å¤±æ•—",e);
        }
        if(spiritPortrait){
          spiritPortrait.src="assets/characters/default.png";
          spiritPortrait.style.opacity="0.82";
        }

        updateSpiritPreviewFromForm();
showScreen("screen-login");
showToast("å·²æ¸…é™¤ä¸Šä¸€å€‹è§’è‰²èˆ‡é ­åƒï¼Œè«‹é‡æ–°ç™»å…¥èˆ‡å‰µè§’ã€‚");
      });
    }

    const resetBtn=document.getElementById("btnResetCharacter");
if(resetBtn){
  resetBtn.addEventListener("click",()=>{
    const listRaw=localStorage.getItem("level23Characters");
    if(listRaw){
      try{
        const list=JSON.parse(listRaw);
        if(Array.isArray(list)&&list.length>0){
          list.pop();
          localStorage.setItem("level23Characters",JSON.stringify(list));
        }
      }catch(e){
        console.warn("é‡å‰µè§’è‰²æ™‚è§£æè§’è‰²åˆ—è¡¨å¤±æ•—",e);
      }
    }

    localStorage.removeItem("level23LastCharacter");

    // æ¸…ç©ºå‰µè§’æ¬„ä½
    fields.charName.value="";
    fields.tribe.value="";
    fields.role.value="";
    fields.element.value="";
    fields.str.value="5";
    fields.int.value="5";
    fields.cha.value="5";
    fields.luck.value="5";
    fields.message.value="";

    // æ¸…é™¤é ­åƒ
    appState.avatarDataUrl=null;
    try{
      sessionStorage.removeItem("playerAvatar");
    }catch(e){
      console.warn("æ¸…é™¤ playerAvatar å¤±æ•—",e);
    }
    if(spiritPortrait){
      spiritPortrait.src="assets/characters/default.png";
      spiritPortrait.style.opacity="0.82";
    }

    updateSpiritPreviewFromForm();
    // ğŸ” é€™è£¡æ”¹æˆå›ç™»å…¥ç•«é¢
    showScreen("screen-login");
    showToast("å·²æ¸…é™¤ä¸Šä¸€å€‹è§’è‰²èˆ‡é ­åƒï¼Œè«‹é‡æ–°ç™»å…¥èˆ‡å‰µè§’ã€‚");
  });
}

    (function(){
      const bgm=document.getElementById("bgm");
      if(!bgm) return;
      bgm.volume=0.15;
      function resumeBgm(){
        if(bgm.paused){
          bgm.play().catch(()=>{});
        }
      }
      document.addEventListener("click",resumeBgm,{once:true});
      document.addEventListener("touchstart",resumeBgm,{once:true});
    })();
  </script>
</body>
</html>
